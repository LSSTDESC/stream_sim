# Simple Stellar Stream Simulator (about stream_sim)

This package provides some tools for simple stellar stream simulation. The goal is to provide a modular codebase that can be easily configured and run. The user should be able to generate a variety of stream morphologies by changing the configuration files. The output will be the "true" properties of stream stars (e.g., location in stream coordinates, heliocentric distance, magnitude, and velocity) that can be used for image-level or catalog-level injection.

Note, this package is not intended to generate dynamic models or N-body simulations, but rather to study statistical realizations of parametrized stream geometries.

## Installation

Installation consists of git cloning `stream_sim`, adding the python module to your `PYTHONPATH`, and adding the `bin` directory to your `PATH`:

```bash
git clone https://github.com/LSSTDESC/stream_sim.git
export PYTHONPATH=${PWD}/stream_sim:${PYTHONPATH}
export PATH=${PWD}/stream_sim/bin:${PATH}
```

The code has some common dependencies (numpy, scipy, pandas, matplotlib) that should be present in your environment.

Eventually stream_sim will be installable through common package managers (i.e., pip and/or conda).

## Examples

Several simple configuration files are provided as examples in the `config` directory. To generate streams from these config files, use the `generate_streams.py` executable found in the `bin` directory. From the `stream_sim` directory, this code can be executed as shown below.

```bash
# Simple linear stream
./bin/generate_stream.py config/toy1_config.yaml -o toy1.csv --plot
# More complex sinusoidal stream
./bin/generate_stream.py config/toy2_config.yaml -o toy2.csv --plot
# Stream generated from Pal 5 interpolation
./bin/generate_stream.py config/pal5_config.yaml -o pal5.csv --plot
# Stream generated from Spline interpolation
./bin/generate_spline_stream.py config/atlas_spline_config.yaml -o atlas_spline.csv --plot
```

# stream_galsim â€” Stellar Stream Simulation using *galpy* (or N-body simulation)

This package requires installation of `galpy`, `gala`, and `seaborn`, in addition to the standard `stream-sim` dependencies.

The `stream_sim` package provides simple functions to simulate stellar streams (`model.py`, `samplers.py`), along with tools to apply survey properties to the sampled stars and use them for stream detection via matched filtering (`observed.py`). The simulation is configured through a YAML `config_file` describing the stream, background, and survey parameters, as well as a stream file (`erkal_*.csv`) formatted as `[Phi1, Phi2, nstars, width]`, which defines the stream in a Phi12 coordinate frame.

Using `galpy` (or `gala`) and `ugali`, one can sample stars within a stellar stream in various coordinate systems (e.g., Galactocentric, RA/Dec, Phi1/Phi2), and assign them magnitudes in specified filters. Configuration starts from a file generated by `create_config_file.py`, which can automatically build a `galstream_<clustername>_config.yaml` from the *galstreams* catalog, or from custom coordinates.

Once the stream is sampled, `stream_search` can either:

- Start from a `full_<clustername>.csv` file by applying observational properties to existing star data, or  
- Use an Erkal-style file to sample positions and magnitudes, then apply survey characteristics.

---

## Contents

### Notebooks

- **injection_lsst_updated**: Applies observational properties, merges with survey catalogs, and performs isochrone matched filtering. Based on `injection_lsst_example` with some modifications.
- **stream_sim_galpy**: Detailed simulation of the Palomar 5 stream using `galpy`.
- **tests_on_gala**: Comparison of `gala` vs `galpy` in terms of performance and results.
- **tests_stream_generator**: Development notebook for the main `stream_generator` script.
- **N-body streams simulation**: Simulates more realistic stellar streams using `gala`'s N-body tools.

### Scripts

- **stream_generator**: Main script to generate a stellar stream using a keyword file (`stream_gen_keywords.txt`). Outputs either a density map configuration or star data with magnitudes (in `.csv` format).
- **stream_utils**: Utility functions for generating and analyzing simulated streams.
- **create_config_file**: Generates a stream configuration file from *galstreams* data.
- **generator_keywords**: Default configuration keywords for use with `stream_generator`.
